version: "3.0.0"
name: "test_ema_stack_supertrend"
description: "Long when bullish supertrend with 9/21/55 EMA stack held for 4 bars"

symbol: "SOLUSDT"
timeframes:
  low_tf: "5m"
  med_tf: "1h"
  high_tf: "4h"
  exec: "low_tf"

account:
  starting_equity_usdt: 10000.0
  max_leverage: 3.0
  margin_mode: "isolated_usdt"
  min_trade_notional_usdt: 10.0
  fee_model:
    taker_bps: 5.5
    maker_bps: 2.0
  slippage_bps: 2.0

features:
  supertrend_10_3:
    indicator: supertrend
    params:
      length: 10
      multiplier: 3.0
  ema_9:
    indicator: ema
    params:
      length: 9
  ema_21:
    indicator: ema
    params:
      length: 21
  ema_55:
    indicator: ema
    params:
      length: 55

actions:
  entry_long:
    all:
      # Supertrend bullish (direction = 1)
      - ["supertrend_10_3.direction", "==", 1]
      # EMA stack aligned for 4 consecutive bars
      - holds_for:
          bars: 4
          expr:
            all:
              - ["ema_9", ">", "ema_21"]
              - ["ema_21", ">", "ema_55"]
  exit_long:
    holds_for:
      bars: 5
      expr:
        all:
          - ["ema_9", "<", "ema_55"]
          - ["ema_21", "<", "ema_55"]

position_policy:
  mode: long_only
  exit_mode: first_hit

risk:
  stop_loss_pct: 5.0
  max_position_pct: 50.0
