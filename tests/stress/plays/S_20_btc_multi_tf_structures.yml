version: "3.0.0"
name: "S_20_btc_multi_tf_structures"
description: "Stress Test Gate 5.3: Multi-TF Structures - 95% complexity"

symbol: "BTCUSDT"
timeframes:
  low_tf: "15m"
  med_tf: "15m"
  high_tf: "1h"
  exec: "low_tf"

account:
  starting_equity_usdt: 10000.0
  max_leverage: 1.0
  margin_mode: isolated_usdt
  min_trade_notional_usdt: 10.0
  fee_model:
    taker_bps: 6.0
    maker_bps: 1.0
  slippage_bps: 2.0

features:
  ema_20:
    indicator: ema
    params: {length: 20}
  rsi_14:
    indicator: rsi
    params: {length: 14}
  atr_14:
    indicator: atr
    params: {length: 14}
  ema_50_1h:
    indicator: ema
    tf: "1h"
    params: {length: 50}

structures:
  exec:
    - type: swing
      key: swing
      params:
        left: 3
        right: 3
  high_tf:
    "1h":
      - type: swing
        key: swing_1h
        params:
          left: 5
          right: 5

# Gate 5.3 (95%): Multi-TF Structures
# Tests:
# - Exec TF structures (swing on 15m)
# - HTF structures (swing on 1h)
# - Cross-TF indicator (ema_50_1h)
# - Combining exec + HTF structure outputs
actions:
  entry_long:
    all:
      - ["close", ">", "swing.low_level"]
      - ["close", ">", "swing_1h.low_level"]
      - ["close", ">", "ema_50_1h"]
      - ["rsi_14", "<", 65]

  exit_long:
    any:
      - ["close", "<", "swing.low_level"]
      - ["close", "<", "swing_1h.low_level"]

position_policy:
  mode: long_only
  exit_mode: signal

risk:
  stop_loss_pct: 2.0
  take_profit_pct: 4.0
  max_position_pct: 95.0

_test_metadata:
  test_id: "S_20"
  category: "multi_tf_structures"
  gate: "5.3"
  complexity_pct: 95
  min_signals: 2
  max_signals: 50
  warmup_bars: 60
  tests:
    - "exec_tf_structure"
    - "htf_structure"
    - "cross_tf_indicator"
    - "multi_tf_condition_combination"
