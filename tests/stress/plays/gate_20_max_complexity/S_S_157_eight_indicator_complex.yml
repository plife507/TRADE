version: "3.0.0"
name: "S_S_157_eight_indicator_complex"
description: "Stress Gate 20: Maximum indicator count (8+) with complex boolean logic (short). XRPUSDT."

symbol: "XRPUSDT"
tf: "15m"
med_tf: "1h"
high_tf: "4h"

account:
  starting_equity_usdt: 10000.0
  max_leverage: 1.0
  margin_mode: isolated_usdt
  min_trade_notional_usdt: 10.0
  fee_model:
    taker_bps: 6.0
    maker_bps: 1.0
  slippage_bps: 2.0

features:
  # 1. EMA - trend
  ema_9:
    indicator: ema
    params: {length: 9}
  ema_21:
    indicator: ema
    params: {length: 21}

  # 2. SMA - longer trend
  sma_50:
    indicator: sma
    params: {length: 50}

  # 3. RSI - momentum
  rsi_14:
    indicator: rsi
    params: {length: 14}

  # 4. Stochastic - overbought/oversold
  stoch_14_3_3:
    indicator: stoch
    params: {k: 14, d: 3, smooth_k: 3}

  # 5. MACD - trend momentum
  macd_12_26_9:
    indicator: macd
    params: {fast: 12, slow: 26, signal: 9}

  # 6. Bollinger Bands - volatility
  bbands_20_2:
    indicator: bbands
    params: {length: 20, std: 2.0}

  # 7. ADX - trend strength
  adx_14:
    indicator: adx
    params: {length: 14}

  # 8. SuperTrend - trend direction
  supertrend_10_3:
    indicator: supertrend
    params: {length: 10, multiplier: 3}

  # 9. ATR - volatility measure
  atr_14:
    indicator: atr
    params: {length: 14}

  # 10. Fisher - momentum reversal
  fisher_9:
    indicator: fisher
    params: {length: 9}

actions:
  entry_short:
    all:
      # Core trend: EMA alignment (bearish)
      - ["ema_9", "<", "ema_21"]
      - ["ema_21", "<", "sma_50"]
      # Trend strength: ADX > 20
      - [{feature_id: "adx_14", field: "adx"}, ">", 20]
      # SuperTrend bearish
      - [{feature_id: "supertrend_10_3", field: "direction"}, "==", -1]
      # Complex oscillator logic: any of these bearish signals
      - any:
          # RSI + Stoch combo
          - all:
              - ["rsi_14", ">", 60]
              - [{feature_id: "stoch_14_3_3", field: "stoch_k"}, ">", 70]
          # MACD bearish cross recent
          - all:
              - occurred_within:
                  bars: 5
                  expr:
                    - [{feature_id: "macd_12_26_9", field: "macd"}, "cross_below", {feature_id: "macd_12_26_9", field: "signal"}]
              - [{feature_id: "macd_12_26_9", field: "histogram"}, "<", 0]
          # Fisher reversal
          - all:
              - [{feature_id: "fisher_9", field: "fisher"}, "cross_below", {feature_id: "fisher_9", field: "fisher_signal"}]
              - [{feature_id: "fisher_9", field: "fisher"}, ">", 0]
      # Price position: near upper BB or below middle
      - any:
          - lhs: "close"
            op: near_pct
            rhs: {feature_id: "bbands_20_2", field: "upper"}
            tolerance: 0.01
          - ["close", "<", {feature_id: "bbands_20_2", field: "middle"}]

  exit_short:
    any:
      # Trend reversal
      - ["ema_9", ">", "ema_21"]
      - [{feature_id: "supertrend_10_3", field: "direction"}, "==", 1]
      # Oversold exhaustion
      - all:
          - ["rsi_14", "<", 25]
          - [{feature_id: "stoch_14_3_3", field: "stoch_k"}, "<", 15]
          - ["close", "<", {feature_id: "bbands_20_2", field: "lower"}]
      # MACD bullish cross
      - [{feature_id: "macd_12_26_9", field: "macd"}, "cross_above", {feature_id: "macd_12_26_9", field: "signal"}]

position_policy:
  mode: short_only
  exit_mode: signal
  max_positions_per_symbol: 1

risk:
  stop_loss_pct: 2.5
  take_profit_pct: 5.0
  max_position_pct: 10.0

_test_metadata:
  gate: 20
  complexity_pct: 100
  category: "max_complexity"
  direction: "short"
  features_tested:
    - "8_plus_indicators"
    - "ema_sma_combined"
    - "stoch_multi_output"
    - "macd_multi_output"
    - "bbands_multi_output"
    - "adx_multi_output"
    - "supertrend_direction"
    - "fisher_multi_output"
    - "nested_any_all"
    - "near_pct"
    - "cross_operators"
    - "occurred_within"
