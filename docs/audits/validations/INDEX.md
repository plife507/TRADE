# Audit Validations Index

**PURPOSE:** Invariants, gates, validation reports, coverage checks

---

## Pre-Merge Gates

| Gate | Command | Pass Criteria |
|------|---------|---------------|
| Toolkit Contract | `backtest audit-toolkit` | 42/42 indicators |
| Math Parity | `backtest math-parity` | max_diff < 1e-8 |
| Snapshot Plumbing | `backtest audit-snapshot-plumbing` | 0 failures |

---

## Invariants (Enforced at Runtime)

### Accounting Invariants
```python
equity_usd == cash_balance_usd + unrealized_pnl_usd
free_margin_usd == equity_usd - used_margin_usd
available_balance_usd == max(0.0, free_margin_usd)
```

### Timing Invariants
```python
snapshot.ts_close == bar.ts_close  # Verified every bar
snapshot.ts_close <= current_time  # No look-ahead
```

### Data Invariants
```python
bar.high >= bar.low
bar.high >= bar.open
bar.high >= bar.close
bar.low <= bar.open
bar.low <= bar.close
```

### Mode Constraints
```python
symbol.endswith("USDT")  # USDT-only
margin_mode == "isolated"  # Isolated-only
position_mode == "one_way"  # One-way only
```

---

## Validation Reports

| Report | Location | Generated By |
|--------|----------|--------------|
| Preflight Report | `run-NNN/preflight_report.json` | `runtime/preflight.py` |
| Pipeline Signature | `run-NNN/pipeline_signature.json` | `artifacts/pipeline_signature.py` |
| Indicator Metadata | `artifacts/indicator_metadata.json` | `runtime/indicator_metadata.py` |

---

## Coverage Checks

### Data Coverage
- OHLCV present for date range
- All required TFs available
- Warmup data sufficient
- No critical gaps

### Indicator Coverage
- All declared indicators computed
- No undeclared indicator access
- NaN handling correct

### MTF Coverage
- HTF/MTF data aligned
- Forward-fill correct
- Index mapping valid

---

## Historical Validation Results

| Test | Date | Result | Reference |
|------|------|--------|-----------|
| Long-horizon 1-year | Dec 2025 | ✅ PASS | `docs/_archived/validation__backtest_results_1year_summary.md` |
| Low-TF stress test | Dec 2025 | ✅ PASS | `docs/_archived/validation__low_tf_stress_test_results.md` |
| Snapshot plumbing | Dec 2025 | ✅ PASS | 39,968 comparisons, 0 failures |

---

