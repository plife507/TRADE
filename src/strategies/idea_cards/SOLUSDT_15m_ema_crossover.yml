# IdeaCard: SOLUSDT 15m EMA Crossover with HTF Filters
# Purpose: Phase 8 smoke test for the Idea Card pipeline
# This is a long-only trend-following strategy with:
# - EMA crossover on 15m (execution timeframe)
# - HTF trend filter on 4h (EMA200)
# - MTF momentum filter on 1h (RSI14)

id: SOLUSDT_15m_ema_crossover
version: "1.0.0"
name: "SOL 15m EMA Crossover + HTF Filters"
description: |
  Long-only trend-following strategy.
  Entry: EMA20 crosses above EMA50 on 15m, with 4h EMA200 trend filter and 1h RSI confirmation.
  Exit: EMA20 crosses below EMA50, or SL/TP hit.
  Risk: 1:3 RR ratio with ATR-based stop loss.

symbol_universe:
  - SOLUSDT

tf_configs:
  exec:
    tf: "15m"
    role: "exec"
    warmup_bars: 50
    feature_specs:
      - indicator_type: "ema"
        output_key: "ema_20"
        params:
          length: 20
        input_source: "close"
      - indicator_type: "ema"
        output_key: "ema_50"
        params:
          length: 50
        input_source: "close"
      - indicator_type: "atr"
        output_key: "atr_14"
        params:
          length: 14
  
  mtf:
    tf: "1h"
    role: "mtf"
    warmup_bars: 20
    feature_specs:
      - indicator_type: "rsi"
        output_key: "rsi_14"
        params:
          length: 14
        input_source: "close"
      - indicator_type: "ema"
        output_key: "ema_200"
        params:
          length: 200
        input_source: "close"
  
  htf:
    tf: "4h"
    role: "htf"
    warmup_bars: 200
    feature_specs:
      - indicator_type: "ema"
        output_key: "ema_200"
        params:
          length: 200
        input_source: "close"

bars_history_required: 2  # Need 2 bars for crossover detection

position_policy:
  mode: "long_only"
  max_positions_per_symbol: 1
  allow_flip: false
  allow_scale_in: false
  allow_scale_out: false

signal_rules:
  entry_rules:
    # LONG entry: EMA crossover + HTF trend + MTF momentum
    - direction: "long"
      conditions:
        # EMA20 crosses above EMA50 (exec TF)
        - indicator_key: "ema_20"
          operator: "cross_above"
          value: "ema_50"
          is_indicator_comparison: true
          tf: "exec"
          prev_offset: 1
        # Price above 4h EMA200 (HTF trend filter)
        - indicator_key: "close"
          operator: "gt"
          value: "ema_200"
          is_indicator_comparison: true
          tf: "htf"
        # 1h RSI above 50 (MTF momentum filter)
        - indicator_key: "rsi_14"
          operator: "gt"
          value: 50.0
          is_indicator_comparison: false
          tf: "mtf"
  
  exit_rules:
    # LONG exit: EMA cross-down
    - direction: "long"
      exit_type: "signal"
      conditions:
        # EMA20 crosses below EMA50
        - indicator_key: "ema_20"
          operator: "cross_below"
          value: "ema_50"
          is_indicator_comparison: true
          tf: "exec"
          prev_offset: 1

risk_model:
  stop_loss:
    type: "atr_multiple"
    value: 1.5  # SL = entry - 1.5 * ATR
    atr_key: "atr_14"
    buffer_pct: 0.0
  
  take_profit:
    type: "rr_ratio"
    value: 3.0  # TP at 3:1 RR (3x the SL distance)
  
  sizing:
    model: "percent_equity"
    value: 2.0  # 2% of equity per trade
    max_leverage: 2.0
