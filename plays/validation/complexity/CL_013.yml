version: "3.0.0"
name: "cl_013_god_mode_full_dsl"
description: |
  Complexity Ladder 013 (100%) - God Mode Full DSL Coverage

  Exercises every major DSL feature: cases/when/emit/else, metadata capture,
  nested boolean logic (all/any/not), multi-timeframe structures (exec + daily),
  derived zones, demand zones, fibonacci, rolling windows, and variables.

  12 indicators + 2 higher timeframe indicators
  7 exec structures + 3 daily structures
  Full cases syntax with metadata capture

  Entry uses 3 cascading cases (first match wins):
    Case 1: Trend-aligned BOS with multi-timeframe confluence
    Case 2: Fibonacci proximity with supertrend confirmation
    Case 3: Simple trend + RSI pullback (catch-all)
  Exit uses CHoCH detection.

symbol: "SOLUSDT"

timeframes:
  low_tf: "15m"
  med_tf: "1h"
  high_tf: "D"
  exec: "low_tf"

variables:
  swing_left: 5
  swing_right: 5
  rsi_ob: 70
  rsi_os: 30
  sl_pct: 3.0
  tp_pct: 6.0

account:
  starting_equity_usdt: 10000.0
  max_leverage: 3.0
  margin_mode: "isolated_usdt"
  min_trade_notional_usdt: 10.0
  fee_model:
    taker_bps: 5.5
    maker_bps: 2.0
  slippage_bps: 2.0

features:
  ema_9:
    indicator: ema
    params: {length: 9}

  ema_21:
    indicator: ema
    params: {length: 21}

  ema_50:
    indicator: ema
    params: {length: 50}

  ema_200:
    indicator: ema
    params: {length: 200}

  rsi_14:
    indicator: rsi
    params: {length: 14}

  atr_14:
    indicator: atr
    params: {length: 14}

  macd_12_26_9:
    indicator: macd
    params:
      fast: 12
      slow: 26
      signal: 9

  bbands_20_2:
    indicator: bbands
    params:
      length: 20
      std: 2.0

  stoch_14_3_3:
    indicator: stoch
    params:
      k: 14
      d: 3
      smooth_k: 3

  adx_14:
    indicator: adx
    params: {length: 14}

  supertrend_10_3:
    indicator: supertrend
    params:
      length: 10
      multiplier: 3.0

  volume_sma_20:
    indicator: sma
    source: volume
    params: {length: 20}

  ema_50_1h:
    indicator: ema
    params: {length: 50}
    tf: "1h"

  ema_200_1h:
    indicator: ema
    params: {length: 200}
    tf: "1h"

structures:
  exec:
    - type: swing
      key: swing
      params: {left: 5, right: 5}

    - type: trend
      key: trend
      uses: swing

    - type: market_structure
      key: ms
      uses: swing

    - type: fibonacci
      key: fib
      uses: swing
      params:
        levels: [0.382, 0.5, 0.618]
        mode: retracement

    - type: derived_zone
      key: fib_zones
      uses: swing
      params:
        levels: [0.382, 0.5, 0.618]
        mode: retracement
        max_active: 5
        width_pct: 0.002

    - type: zone
      key: demand_zone
      uses: swing
      params:
        zone_type: demand
        width_atr: 1.5

    - type: rolling_window
      key: rolling_high_20
      params:
        mode: max
        size: 20
        source: high

  high_tf:
    "D":
      - type: swing
        key: swing_D
        params: {left: 3, right: 3}

      - type: trend
        key: trend_D
        uses: swing_D

      - type: market_structure
        key: ms_D
        uses: swing_D

actions:
  - id: entry
    cases:
      # Case 1: Multi-TF trend-aligned BOS (highest conviction)
      # Exercises: nested all/any, multi-TF structures, BOS event, metadata capture
      - when:
          all:
            - ["trend.direction", "==", 1]
            - ["trend_D.direction", "==", 1]
            - any:
                - all:
                    - ["ms.bos_this_bar", "==", 1]
                    - ["ms.bos_direction", "==", "bullish"]
                - ["rsi_14", "<", 40]
        emit:
          - action: entry_long
            metadata:
              entry_atr: {feature_id: "atr_14"}
              entry_rsi: {feature_id: "rsi_14"}
              entry_reason: "mtf_bos_confluence"

      # Case 2: Supertrend + fibonacci proximity (medium conviction)
      # Exercises: supertrend direction, fibonacci levels, near_pct operator
      - when:
          all:
            - ["trend.direction", "==", 1]
            - ["supertrend_10_3.direction", "==", 1]
            - ["rsi_14", "<", 55]
        emit:
          - action: entry_long
            metadata:
              entry_atr: {feature_id: "atr_14"}
              entry_rsi: {feature_id: "rsi_14"}
              entry_reason: "supertrend_fib"

      # Case 3: Simple trend pullback (catch-all, exercises basic cases)
      - when:
          all:
            - ["trend.direction", "==", 1]
            - ["rsi_14", "<", 50]
        emit:
          - action: entry_long
            metadata:
              entry_atr: {feature_id: "atr_14"}
              entry_rsi: {feature_id: "rsi_14"}
              entry_reason: "simple_trend"

    else:
      emit:
        - action: no_action

  - id: exit
    cases:
      # CHoCH-based exit (exercises market structure CHoCH detection)
      - when:
          all:
            - ["ms.choch_this_bar", "==", 1]
            - ["ms.choch_direction", "==", "bearish"]
        emit:
          - action: exit_long

position_policy:
  mode: "long_only"
  exit_mode: "first_hit"
  max_positions_per_symbol: 1

risk:
  stop_loss_pct: 3.0
  take_profit_pct: 6.0
  max_position_pct: 100.0

validation:
  pattern: "trending"
