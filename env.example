# ============================================
# TRADE BOT CONFIGURATION
# ============================================
# Copy this file to api_keys.env and fill in your keys
# ============================================

# ============================================
# FOUR-LEG API ARCHITECTURE
# ============================================
# The system has 4 independent API "legs" for complete separation:
#
# | Leg          | Purpose                | Endpoint           | Key Variable               |
# |--------------|------------------------|--------------------|----------------------------|
# | Trade LIVE   | Real money trading     | api.bybit.com      | BYBIT_LIVE_API_KEY         |
# | Trade DEMO   | Fake money trading     | api-demo.bybit.com | BYBIT_DEMO_API_KEY         |
# | Data LIVE    | Backtest/research data | api.bybit.com      | BYBIT_LIVE_DATA_API_KEY    |
# | Data DEMO    | Demo validation data   | api-demo.bybit.com | BYBIT_DEMO_DATA_API_KEY    |
#
# STRICT: Each leg requires its OWN dedicated API key. NO fallbacks.
#
# CLI Environment Toggles:
#   - Trading env: Set via BYBIT_USE_DEMO (true=demo, false=live)
#   - Data env: CLI Data Builder menu option 23 toggles LIVE/DEMO data
#
# STRICT MODE/API MAPPING (only two valid trading combinations):
#   ✅ paper + BYBIT_USE_DEMO=true  → Demo account (fake funds)
#   ✅ real + BYBIT_USE_DEMO=false  → Live account (real funds)
#   ❌ paper + BYBIT_USE_DEMO=false → BLOCKED (invalid)
#   ❌ real + BYBIT_USE_DEMO=true   → BLOCKED (invalid)
# ============================================

# ============================================
# TRADING MODE
# ============================================
# paper = Demo account trading (fake funds, real API orders)
# real = Live account trading (real funds, real API orders)
#
# IMPORTANT: Trading mode MUST match BYBIT_USE_DEMO setting!
# We never simulate trades - both modes execute real orders on Bybit.
# The difference is which account (demo vs live) receives those orders.
TRADING_MODE=paper

# ============================================
# BYBIT ENVIRONMENT: DEMO vs LIVE
# ============================================
# Bybit provides two separate environments:
#
#   DEMO (FAKE MONEY):
#     - API: api-demo.bybit.com
#     - Purpose: Strategy development, testing, experimentation
#     - Risk: Zero - no real capital at risk
#
#   LIVE (REAL MONEY):
#     - API: api.bybit.com  
#     - Purpose: Production trading with validated strategies
#     - Risk: Real capital - use with strict risk controls!
#
# Each environment requires its own API keys!
# Set this to switch between environments:
#   true = DEMO (FAKE MONEY - safe for testing)
#   false = LIVE (REAL MONEY - use with caution!)
BYBIT_USE_DEMO=true

# ============================================
# DEMO API KEYS (FAKE MONEY)
# ============================================
# Create DEMO keys at: https://www.bybit.com/app/user/api-management
# Select "Demo Trading" when creating the key
# These keys only work with api-demo.bybit.com
BYBIT_DEMO_API_KEY=your_demo_api_key
BYBIT_DEMO_API_SECRET=your_demo_api_secret

# Optional: Separate read-only key for DEMO data (120 RPS vs 50 RPS)
BYBIT_DEMO_DATA_API_KEY=
BYBIT_DEMO_DATA_API_SECRET=

# ============================================
# LIVE API KEYS (REAL MONEY!)
# ============================================
# Create LIVE keys at: https://www.bybit.com/app/user/api-management
# These keys work with api.bybit.com - REAL MONEY!
# Only fill these in when ready for LIVE trading
BYBIT_LIVE_API_KEY=your_live_api_key
BYBIT_LIVE_API_SECRET=your_live_api_secret

# ============================================
# LIVE DATA API KEY (REQUIRED FOR HISTORICAL DATA!)
# ============================================
# IMPORTANT: Historical data and market data ALWAYS use LIVE API
# for accuracy, regardless of BYBIT_USE_DEMO setting.
#
# Create a read-only key (no trading permissions) for data fetching:
# - Higher rate limit (120 RPS vs 50 RPS)
# - Safer (can't execute trades)
# - Required for accurate historical data sync
#
# STRICT: This key is REQUIRED. No fallback to trading keys.
BYBIT_LIVE_DATA_API_KEY=your_live_readonly_key
BYBIT_LIVE_DATA_API_SECRET=your_live_readonly_secret

# ============================================
# DEPRECATED LEGACY KEYS (NOT USED)
# ============================================
# These generic keys are NO LONGER USED for behavior.
# The bot now requires mode-specific keys (DEMO/LIVE).
# Kept here only for reference - do NOT rely on these.
# BYBIT_API_KEY=your_api_key
# BYBIT_API_SECRET=your_api_secret
# BYBIT_DATA_API_KEY=your_data_api_key
# BYBIT_DATA_API_SECRET=your_data_api_secret

# ============================================
# RISK MANAGEMENT
# ============================================
MAX_LEVERAGE=3
MAX_POSITION_SIZE_USD=50
MAX_DAILY_LOSS_USD=20
MIN_BALANCE_USD=10

# ============================================
# TRADING SETTINGS
# ============================================
DEFAULT_SYMBOLS=BTCUSDT,ETHUSDT

# ============================================
# DATA COLLECTION
# ============================================
ENABLE_DATA_CAPTURE=false
DATA_CAPTURE_SYMBOLS=BTCUSDT,ETHUSDT
DATA_CAPTURE_INTERVAL_SECONDS=60

# ============================================
# WEBSOCKET & REALTIME MODE
# ============================================
# WebSocket streams provide real-time data with lower latency than REST polling.
#
# WebSocket Endpoints (handled automatically based on BYBIT_USE_DEMO):
#   - Demo: stream-demo.bybit.com (for demo account data)
#   - Live: stream.bybit.com (for live account data)
#
# PUBLIC streams (tickers, orderbook, klines): Market data is the same
# for DEMO and LIVE, so you can optionally use LIVE streams in DEMO mode.
#
# PRIVATE streams (positions, orders, wallet): Must match your API mode
# since authentication is account-specific.

# Enable WebSocket for real-time data
ENABLE_WEBSOCKET=true

# Runner mode: polling (traditional) or realtime (event-driven)
# realtime mode uses WebSocket events to trigger strategy evaluation
RUNNER_MODE=polling

# Prefer WebSocket data over REST (when available)
PREFER_WEBSOCKET_DATA=true

# Fall back to polling if WebSocket disconnects
WS_FALLBACK_TO_POLLING=true

# Use LIVE WebSocket for public market data even in DEMO mode
# Market data is the same on DEMO and LIVE, this can help if
# DEMO WebSocket has connectivity issues
WS_USE_LIVE_FOR_PUBLIC=false

# Public stream toggles
WS_ENABLE_TICKER=true
WS_ENABLE_ORDERBOOK=false
WS_ENABLE_TRADES=false
WS_ENABLE_KLINES=true

# Kline intervals to subscribe (comma-separated)
WS_KLINE_INTERVALS=15

# Private stream toggles
WS_ENABLE_POSITIONS=true
WS_ENABLE_ORDERS=true
WS_ENABLE_EXECUTIONS=true
WS_ENABLE_WALLET=true

# Rate limiting for realtime mode
WS_MIN_EVAL_INTERVAL=1.0
WS_MAX_EVALS_PER_MINUTE=30

# ============================================
# GLOBAL RISK VIEW (Agent-Ready)
# ============================================
# The GlobalRiskView provides comprehensive portfolio risk monitoring
# for use by the core trading logic and future risk agents.

# Enable GlobalRiskView integration with RiskManager
ENABLE_GLOBAL_RISK_VIEW=true

# Enable public liquidation stream (high-frequency, for market analysis)
WS_ENABLE_PUBLIC_LIQUIDATION=false

# Maximum frequency for rebuilding portfolio snapshots (seconds)
# Lower = more responsive but higher CPU, higher = less responsive but efficient
WS_MAX_GLOBAL_SNAPSHOT_FREQ=1.0

# Enable caching for risk computations (recommended)
WS_ENABLE_RISK_CACHING=true

# ============================================
# LOGGING
# ============================================
LOG_LEVEL=INFO
LOG_DIR=logs

# ============================================
# SMOKE TEST CONFIGURATION
# ============================================
# Settings for non-interactive smoke test suite
# Run with: python trade_cli.py --smoke data   (data builder tests only)
#           python trade_cli.py --smoke full   (all CLI features)
#
# SAFETY: Smoke tests ALWAYS run in DEMO/PAPER mode regardless of settings above.

# Symbols for smoke testing (comma-separated, minimum 3 required)
TRADE_SMOKE_SYMBOLS=BTCUSDT,ETHUSDT,SOLUSDT

# Historical data period to pull (1D, 1W, 1M, 3M, 6M, 1Y)
TRADE_SMOKE_PERIOD=1Y

# Timeframes for OHLCV data (comma-separated)
TRADE_SMOKE_TIMEFRAMES=1h,4h,1d

# USD amount for demo trades (must meet minimum order size, ~$20 covers most symbols)
TRADE_SMOKE_USD_SIZE=20

# Enable gap testing (creates gaps in data, then tests repair)
TRADE_SMOKE_ENABLE_GAP_TESTING=true

# Open interest interval for smoke test
TRADE_SMOKE_OI_INTERVAL=1h

# Include backtest smoke tests (Phase 6)
# These validate preflight, data-fix, and artifact structure
# Set to 1/true to enable (off by default as they require IdeaCards)
TRADE_SMOKE_INCLUDE_BACKTEST=0